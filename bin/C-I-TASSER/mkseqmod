#!/usr/bin/perl
#SBATCH --job-name="!TAG!"
#SBATCH --output="!OUTFILE!"
#SBATCH --error="!ERRFILE!"
#SBATCH --partition=!Q!
#SBATCH --nodes=1
#SBATCH --mem=!MEM!
#SBATCH --ntasks-per-node=1
#SBATCH -t !WALLTIME!
#SBATCH -A !ACCOUNT!

#PBS -e !ERRFILE!
#PBS -o !OUTFILE!
#PBS -l !WALLTIME!

use Math::Trig;

########### setup  the environment and Working DIRectory ###
#$ENV{'PATH'}="/usr/local/bin:/bin:/usr/bin:/usr/X11R6/bin:/usr/pgi/linux86/bin";
#$ENV{'LD_LIBRARY_PATH'}="/usr/local/lib:/usr/lib:/lib";

##### report node -------->
`hostname`=~/(\S+)/;
$node=$1;
printf "hostname: $node\n";
$time=`date`;
printf "starting time: $time";
$pwd=`pwd`;
printf "pwd: $pwd";
#^^^^^^^^^^^^^^^^^^^^^^^^^^

#$tmpdir="/tmp/!USER!/!TAG!";
$tmpdir="/scratch/$ENV{USER}/$ENV{SLURM_JOBID}";
$tmpdir="/tmp/!USER!/!TAG!" if (!-d "$tmpdir" || ! "$ENV{SLURM_JOBID}");
$datadir="!DATADIR!";
$librarydir="!LIBRARYDIR!";

######### psipred ################
$psipreddir="$librarydir/bin/psipred";
system("$psipreddir/runpsipred.pl $tmpdir $datadir seq.txt seq.psi");

######### PSSpred ################
$PSSpreddir="$librarydir/bin/PSSpred";
system("$PSSpreddir/runPSSpred.pl $tmpdir $datadir seq.txt seq.pss exp.dat");

######### combine PSIpred and PSSpred into 'seq.dat'---------->
system("$librarydir/bin/combine_SS.pl $datadir seq.psi.ss seq.pss.ss seq.dat");

################# endding procedure ######################
$time=`date`;
printf "ending time: $time";

exit();

